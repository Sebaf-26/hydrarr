version: "3.9"

services:
  hydrarr:
    build: .
    container_name: hydrarr
    restart: unless-stopped
    ports:
      - "${PORT:-3000}:${PORT:-3000}"
    environment:
      PORT: ${PORT:-3000}
      NODE_ENV: ${NODE_ENV:-production}
      VITE_API_BASE_URL: ${VITE_API_BASE_URL:-}
      SONARR_URL: ${SONARR_URL:-}
      SONARR_API_KEY: ${SONARR_API_KEY:-}
      RADARR_URL: ${RADARR_URL:-}
      RADARR_API_KEY: ${RADARR_API_KEY:-}
      LIDARR_URL: ${LIDARR_URL:-}
      LIDARR_API_KEY: ${LIDARR_API_KEY:-}
      READARR_URL: ${READARR_URL:-}
      READARR_API_KEY: ${READARR_API_KEY:-}
      PROWLARR_URL: ${PROWLARR_URL:-}
      PROWLARR_API_KEY: ${PROWLARR_API_KEY:-}
      BAZARR_URL: ${BAZARR_URL:-}
      BAZARR_API_KEY: ${BAZARR_API_KEY:-}
      QBITTORRENT_URL: ${QBITTORRENT_URL:-}
      QBITTORRENT_USERNAME: ${QBITTORRENT_USERNAME:-}
      QBITTORRENT_PASSWORD: ${QBITTORRENT_PASSWORD:-}

  hydrarr-test:
    image: curlimages/curl:8.8.0
    container_name: hydrarr-test
    depends_on:
      - hydrarr
    restart: "no"
    command:
      - sh
      - -c
      - |
        echo "Running Hydrarr rejected-sample test..."
        sleep 5
        curl -sS "http://hydrarr:${PORT:-3000}/api/debug/rejected-sample"
